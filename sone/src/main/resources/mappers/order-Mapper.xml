<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="OrderMapper">

	<!-- Orders 생성 -->
	<insert id="create" parameterType="OrderVO" useGeneratedKeys="true" >
		insert into orders (orderStatus, member_id) 
		values(#{orderStatus}, #{member_id})
		
		<selectKey keyProperty="order_id" resultType="Integer">
	    	SELECT LAST_INSERT_ID()
	  	</selectKey>
	</insert>
	
	<!-- OrderItem 생성 -->
	<insert id="createOrderItem">
		insert into orderitem (count, orderprice, totalprice, item_id, order_id) 
		values(#{count}, #{orderprice}, #{totalprice}, #{item_id}, #{order_id})
		
	</insert>
	
		
	<!-- 조회 -->
	<select id="read" resultType="OrderVO">
		select 
		  order_id, date, orderstatus, member_id 
		from 
		  orders
		where order_id = #{order_id}
	</select>	
	
	<!-- 나의 주문 조회 -->
	<select id="readOrderItem" resultType="OrderItemVO">
		select 
		  order_item_id, count, orderprice, totalprice, item_id, order_id
		from 
		  orderitem
		where order_item_id = #{order_item_id}
	</select>	
	
	<!-- OrderItem 삭제 -->
	<delete id="deleteOrderItem">
		delete from orderitem where order_item_id = #{order_item_id}
	</delete>		
	
	<!-- Order 삭제 -->
	<delete id="delete">
		delete from orders where order_id = #{order_id}
	</delete>		
	
	<!-- 나의 주문 목록 조회 -->
	<select id="myListAll" resultType="OrderItemVO">
	<![CDATA[
		select 
		  order_item_id, count, orderprice, totalprice, item_id, order_id  
		from 
		  orderitem 
		where order_item_id > 0 
		order by order_item_id asc
	]]>  
	</select>
	
</mapper>
